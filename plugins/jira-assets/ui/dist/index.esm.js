var PluginJiraAssets=function(K,e,r,s){"use strict";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var le={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),T=(l,b)=>{const f=r.forwardRef(({color:C="currentColor",size:W=24,strokeWidth:L=2,absoluteStrokeWidth:d,className:v="",children:S,...z},o)=>r.createElement("svg",{ref:o,...le,width:W,height:W,stroke:C,strokeWidth:d?Number(L)*24/Number(W):L,className:["lucide",`lucide-${ce(l)}`,v].join(" "),...z},[...b.map(([E,O])=>r.createElement(E,O)),...Array.isArray(S)?S:[S]]));return f.displayName=`${l}`,f};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=T("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=T("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=T("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=T("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=T("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=T("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=T("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=T("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=T("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=T("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=T("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=T("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),re=({pluginApiCall:l,selectedObjectTypeId:b})=>{const[f,C]=r.useState([]),[W,L]=r.useState([]),[d,v]=r.useState({}),[S,z]=r.useState(!1),[o,E]=r.useState(!1),[O,p]=r.useState(null),[J,j]=r.useState(null),_=r.useCallback(async()=>{if(!(!l||!b))try{const a=await l("GET",`/object-types/${b}/attributes`);Array.isArray(a)&&C(a)}catch(a){console.error("Failed to load JIRA attributes:",a)}},[l,b]),N=r.useCallback(async()=>{if(l)try{const a=await l("GET","/vw-attributes");Array.isArray(a)&&L(a)}catch(a){console.error("Failed to load VW attributes:",a)}},[l]),x=r.useCallback(async()=>{if(l)try{const a=await l("GET","/mappings");a&&typeof a=="object"&&v(a)}catch(a){console.error("Failed to load mappings:",a)}},[l]);r.useEffect(()=>{z(!0),Promise.all([N(),x()]).finally(()=>z(!1))},[N,x]),r.useEffect(()=>{b&&_()},[b,_]);const P=(a,g)=>{v(w=>{const F={...w};return g===""?delete F[a]:F[a]=g,F})},G=a=>{v(g=>{const w={...g};return delete w[a],w})},q=async()=>{if(l){E(!0),p(null),j(null);try{const a=await l("POST","/mappings",{mappings:d});a!=null&&a.success?j(a.message||"Mappings saved successfully"):p((a==null?void 0:a.error)||"Failed to save mappings")}catch(a){p(a.message||"Failed to save mappings")}finally{E(!1)}}},B=new Set(Object.values(d));return S?e.jsx(s.Box,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(s.CircularProgress,{size:24})}):b?e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",fontSize:13,sx:{mb:2},children:"Map JIRA attributes to VerifyWise AI System attributes. Mapped attributes will be stored alongside the original JIRA data for compliance and reporting."}),O&&e.jsx(s.Alert,{severity:"error",sx:{mb:2,fontSize:"13px"},onClose:()=>p(null),children:O}),J&&e.jsx(s.Alert,{severity:"success",sx:{mb:2,fontSize:"13px"},onClose:()=>j(null),children:J}),f.length===0?e.jsx(s.Alert,{severity:"warning",sx:{fontSize:"13px"},children:"No JIRA attributes found. Please ensure the object type has attributes defined."}):e.jsxs(e.Fragment,{children:[e.jsx(s.TableContainer,{component:s.Paper,sx:{maxHeight:400,mb:2,boxShadow:"none",border:"1px solid #e4e7ec"},children:e.jsxs(s.Table,{size:"small",stickyHeader:!0,children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{sx:{backgroundColor:"#f9fafb"},children:[e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",width:"40%"},children:"JIRA Attribute"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",width:"10%",textAlign:"center"}}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",width:"45%"},children:"VerifyWise Attribute"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",width:"5%"}})]})}),e.jsx(s.TableBody,{children:f.map(a=>e.jsxs(s.TableRow,{hover:!0,children:[e.jsx(s.TableCell,{sx:{fontSize:"13px"},children:a.name}),e.jsx(s.TableCell,{sx:{textAlign:"center"},children:e.jsx(ie,{size:16,color:"#98a2b3"})}),e.jsx(s.TableCell,{children:e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:d[a.name]||"",onChange:g=>P(a.name,g.target.value),displayEmpty:!0,sx:{fontSize:"13px"},children:[e.jsx(s.MenuItem,{value:"",sx:{fontSize:"13px",color:"#98a2b3"},children:"-- Not Mapped --"}),W.map(g=>e.jsxs(s.MenuItem,{value:g.name,sx:{fontSize:"13px"},disabled:B.has(g.name)&&d[a.name]!==g.name,children:[g.name,B.has(g.name)&&d[a.name]!==g.name&&e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{ml:1},children:"(already mapped)"})]},g.name))]})})}),e.jsx(s.TableCell,{children:d[a.name]&&e.jsx(s.Tooltip,{title:"Clear mapping",children:e.jsx(s.IconButton,{size:"small",onClick:()=>G(a.name),children:e.jsx(R,{size:14})})})})]},a.id))})]})}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s.Typography,{variant:"caption",color:"text.secondary",children:[Object.keys(d).length," of ",f.length," attributes mapped"]}),e.jsx(s.Button,{variant:"contained",onClick:q,disabled:o,startIcon:o?e.jsx(s.CircularProgress,{size:16}):e.jsx(be,{size:16}),sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px",fontWeight:500,"&:hover":{backgroundColor:"#0f5a47"},"&:disabled":{backgroundColor:"#d0d5dd"}},children:o?"Saving...":"Save Mappings"})]})]})]}):e.jsx(s.Alert,{severity:"info",sx:{fontSize:"13px"},children:"Please select a Schema and Object Type in Step 2 to configure attribute mappings."})},xe=({configData:l={},onConfigChange:b,onSaveConfiguration:f,onTestConnection:C,isSavingConfig:W=!1,isTestingConnection:L=!1,apiServices:d,pluginApiCall:v})=>{const S=r.useCallback(async(t,i,k)=>{var M;if(v)return v(t,i,k);if(!d)throw new Error("No API service available");const y=`/plugins/jira-assets${i.startsWith("/")?i:`/${i}`}`;let u;switch(t.toUpperCase()){case"GET":u=await d.get(y);break;case"POST":u=await d.post(y,k);break;case"PUT":u=await d.put(y,k);break;case"PATCH":u=await d.patch(y,k);break;case"DELETE":u=await d.delete(y);break;default:throw new Error(`Unsupported method: ${t}`)}return((M=u.data)==null?void 0:M.data)??u.data},[d,v]),z=!!(d||v),[o,E]=r.useState({deployment_type:"cloud",sync_enabled:!1,sync_interval_hours:24,...l}),[O,p]=r.useState(!1),[J,j]=r.useState([]),[_,N]=r.useState([]),[x,P]=r.useState(!1),[G,q]=r.useState(!1),[B,a]=r.useState("idle"),[g,w]=r.useState(""),[F,Y]=r.useState(!1),[c,$]=r.useState(null);r.useEffect(()=>{if(O||!d)return;(async()=>{var i;try{const y=await d.get("/plugins/jira-assets/config"),u=((i=y.data)==null?void 0:i.data)??y.data;u&&E(M=>({...M,...u}))}catch(k){console.error("Failed to load JIRA config:",k)}finally{p(!0)}})()},[d,O]);const I=r.useCallback((t,i)=>{E(k=>({...k,[t]:i})),b&&b(t,i)},[b]),V=r.useCallback(async()=>{if(!(!z||!o.jira_base_url||!o.workspace_id)){P(!0);try{const t=await S("GET","/schemas");t&&Array.isArray(t)&&j(t)}catch(t){console.error("Failed to load schemas:",t)}finally{P(!1)}}},[z,S,o.jira_base_url,o.workspace_id]),D=r.useCallback(async t=>{if(!(!z||!t)){q(!0);try{const i=await S("GET",`/schemas/${t}/object-types`);console.log("[JiraConfig] loadObjectTypes response:",i,"isArray:",Array.isArray(i)),i&&Array.isArray(i)?N(i):console.warn("[JiraConfig] Object types response is not an array:",typeof i)}catch(i){console.error("Failed to load object types:",i)}finally{q(!1)}}},[z,S]),Z=async()=>{if(!z){C&&C();return}a("testing"),w("");try{const t=await S("POST","/test-connection",{configuration:{jira_base_url:o.jira_base_url,workspace_id:o.workspace_id,email:o.email,api_token:o.api_token,deployment_type:o.deployment_type||"cloud"}});t!=null&&t.success?(a("success"),w(t.message||"Connection successful. Click 'Save Configuration' to proceed to Step 2.")):(a("error"),w((t==null?void 0:t.message)||"Connection failed"))}catch(t){a("error"),w(t.message||"Connection test failed")}},ee=async()=>{var t,i;if(d){Y(!0),$(null);try{const k=await d.post("/plugins/jira-assets/config",{jira_base_url:o.jira_base_url,workspace_id:o.workspace_id,email:o.email,api_token:o.api_token||void 0,deployment_type:o.deployment_type||"cloud",selected_schema_id:o.selected_schema_id||void 0,selected_object_type_id:o.selected_object_type_id||void 0,sync_enabled:o.sync_enabled||!1,sync_interval_hours:o.sync_interval_hours||24}),y=((t=k.data)==null?void 0:t.data)??k.data;y!=null&&y.success?($({type:"success",text:"Configuration saved successfully!"}),E(u=>({...u,has_api_token:!0})),p(!1)):$({type:"error",text:((i=y==null?void 0:y.errors)==null?void 0:i.join(", "))||(y==null?void 0:y.message)||"Failed to save configuration"})}catch(k){$({type:"error",text:k.message||"Failed to save configuration"})}finally{Y(!1)}}},se=t=>{I("selected_schema_id",t),I("selected_object_type_id",""),N([]),t&&D(t)};r.useEffect(()=>{console.log("[JiraConfig] Schema load check:",{has_api_token:o.has_api_token,jira_base_url:o.jira_base_url,workspace_id:o.workspace_id,schemas_length:J.length}),o.has_api_token&&o.jira_base_url&&o.workspace_id&&J.length===0&&(console.log("[JiraConfig] Calling loadSchemas()"),V())},[o.has_api_token,o.jira_base_url,o.workspace_id,V,J.length]),r.useEffect(()=>{o.has_api_token&&o.selected_schema_id&&_.length===0&&D(o.selected_schema_id)},[o.has_api_token,o.selected_schema_id,D,_.length]);const oe=[{value:1,label:"Every hour"},{value:6,label:"Every 6 hours"},{value:12,label:"Every 12 hours"},{value:24,label:"Every 24 hours"},{value:48,label:"Every 48 hours"}];return e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",fontSize:13,sx:{mb:3},children:"Connect to your Jira Service Management Assets to import AI Systems as use-cases."}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 1: Connection Settings"}),e.jsxs(s.Stack,{spacing:2.5,children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Deployment Type *"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:o.deployment_type||"cloud",onChange:t=>I("deployment_type",t.target.value),sx:{fontSize:"13px",backgroundColor:"white"},children:[e.jsx(s.MenuItem,{value:"cloud",sx:{fontSize:"13px"},children:"JIRA Cloud (Atlassian-hosted)"}),e.jsx(s.MenuItem,{value:"datacenter",sx:{fontSize:"13px"},children:"JIRA Data Center / Server (Self-hosted)"})]})}),e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:"Select Cloud for *.atlassian.net, or Data Center for self-hosted JIRA"})]}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"JIRA Base URL *"}),e.jsx(s.TextField,{fullWidth:!0,placeholder:o.deployment_type==="datacenter"?"https://jira.your-company.com":"https://your-company.atlassian.net",value:o.jira_base_url||"",onChange:t=>I("jira_base_url",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}})]}),e.jsxs(s.Box,{children:[e.jsxs(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:[o.deployment_type==="datacenter"?"Insight Object Schema ID":"Workspace ID"," *"]}),e.jsx(s.TextField,{fullWidth:!0,placeholder:o.deployment_type==="datacenter"?"Enter object schema ID (e.g., 1)":"Enter your JSM Assets workspace ID",value:o.workspace_id||"",onChange:t=>I("workspace_id",t.target.value),size:"small",helperText:o.deployment_type==="datacenter"?"For Data Center: Use object schema ID from Insight settings":"Found in Assets settings or the URL when viewing Assets",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}})]}),e.jsxs(s.Box,{children:[e.jsxs(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:[o.deployment_type==="datacenter"?"Username":"Email"," *"]}),e.jsx(s.TextField,{fullWidth:!0,type:o.deployment_type==="datacenter"?"text":"email",placeholder:o.deployment_type==="datacenter"?"your-username":"your-email@company.com",value:o.email||"",onChange:t=>I("email",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}})]}),e.jsxs(s.Box,{children:[e.jsxs(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:[o.deployment_type==="datacenter"?"Password / Token":"API Token"," ",!o.has_api_token&&"*"]}),e.jsx(s.TextField,{fullWidth:!0,type:"password",placeholder:o.has_api_token&&!o.api_token?"••••••••••••••••  (saved - enter new value to change)":o.deployment_type==="datacenter"?"Enter your password or personal access token":"Enter your Atlassian API token",value:o.api_token||"",onChange:t=>I("api_token",t.target.value),size:"small",helperText:o.has_api_token&&!o.api_token?"API token is saved. Leave empty to keep current token, or enter a new value to update.":o.deployment_type==="datacenter"?"Use your JIRA password or personal access token":"Generate at id.atlassian.com/manage-profile/security/api-tokens",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}})]})]}),B!=="idle"&&e.jsx(s.Box,{sx:{mt:2},children:e.jsx(s.Alert,{severity:B==="success"?"success":B==="error"?"error":"info",sx:{fontSize:"13px"},children:B==="testing"?"Testing connection...":g})}),e.jsx(s.Box,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(s.Button,{variant:"outlined",onClick:Z,disabled:L||B==="testing"||!o.jira_base_url||!o.workspace_id||!o.email||!o.api_token&&!o.has_api_token,sx:{borderColor:"#13715B",color:"#13715B",textTransform:"none",fontSize:"13px",fontWeight:500,"&:hover":{borderColor:"#0f5a47",backgroundColor:"rgba(19, 113, 91, 0.04)"},"&:disabled":{borderColor:"#d0d5dd",color:"#98a2b3"}},children:L||B==="testing"?e.jsxs(e.Fragment,{children:[e.jsx(s.CircularProgress,{size:16,sx:{mr:1}}),"Testing..."]}):"Test Connection"})}),e.jsx(s.Divider,{sx:{my:3}}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 2: Select Schema & Object Type"}),e.jsxs(s.Stack,{spacing:2.5,children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Schema"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:o.selected_schema_id||"",onChange:t=>se(t.target.value),disabled:x||J.length===0,displayEmpty:!0,sx:{fontSize:"13px",backgroundColor:"white"},children:[e.jsx(s.MenuItem,{value:"",sx:{fontSize:"13px"},children:x?"Loading schemas...":"Select a schema"}),J.map(t=>e.jsxs(s.MenuItem,{value:t.id,sx:{fontSize:"13px"},children:[t.name," (",t.objectSchemaKey,")"]},t.id))]})})]}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Object Type (AI Systems)"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:o.selected_object_type_id||"",onChange:t=>I("selected_object_type_id",t.target.value),disabled:G||_.length===0||!o.selected_schema_id,displayEmpty:!0,sx:{fontSize:"13px",backgroundColor:"white"},children:[e.jsx(s.MenuItem,{value:"",sx:{fontSize:"13px"},children:G?"Loading object types...":"Select an object type"}),_.map(t=>e.jsxs(s.MenuItem,{value:t.id,sx:{fontSize:"13px"},children:[t.name,t.objectCount!==void 0&&e.jsx(s.Chip,{label:`${t.objectCount} objects`,size:"small",sx:{ml:1,fontSize:"11px"}})]},t.id))]})})]})]}),e.jsx(s.Divider,{sx:{my:3}}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 3: Sync Settings"}),e.jsxs(s.Stack,{spacing:2.5,children:[e.jsx(s.Box,{children:e.jsx(s.FormControlLabel,{control:e.jsx(s.Switch,{checked:o.sync_enabled||!1,onChange:t=>I("sync_enabled",t.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#13715B"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#13715B"}}}),label:e.jsx(s.Typography,{variant:"body2",fontSize:13,sx:{color:"#344054"},children:"Enable automatic sync"})})}),o.sync_enabled&&e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Sync Interval"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsx(s.Select,{value:o.sync_interval_hours||24,onChange:t=>I("sync_interval_hours",t.target.value),sx:{fontSize:"13px",backgroundColor:"white"},children:oe.map(t=>e.jsx(s.MenuItem,{value:t.value,sx:{fontSize:"13px"},children:t.label},t.value))})})]})]}),o.last_sync_at&&e.jsx(s.Box,{sx:{mt:2},children:e.jsxs(s.Alert,{severity:o.last_sync_status==="success"?"success":"warning",sx:{fontSize:"13px"},children:["Last sync: ",new Date(o.last_sync_at).toLocaleString()," -"," ",o.last_sync_status==="success"?"Successful":o.last_sync_message]})}),e.jsx(s.Divider,{sx:{my:3}}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 4: Attribute Mapping (Optional)"}),e.jsx(re,{pluginApiCall:S,selectedObjectTypeId:o.selected_object_type_id}),c&&e.jsx(s.Box,{sx:{mt:2},children:e.jsx(s.Alert,{severity:c.type,sx:{fontSize:"13px"},onClose:()=>$(null),children:c.text})}),e.jsx(s.Box,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:e.jsx(s.Button,{variant:"contained",onClick:ee,disabled:F||!o.jira_base_url||!o.workspace_id||!o.email||!o.api_token&&!o.has_api_token,sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px",fontWeight:500,"&:hover":{backgroundColor:"#0f5a47"},"&:disabled":{backgroundColor:"#d0d5dd"}},children:F?e.jsxs(e.Fragment,{children:[e.jsx(s.CircularProgress,{size:16,sx:{mr:1,color:"white"}}),"Saving..."]}):"Save Configuration"})})]})},Se=({apiServices:l,pluginApiCall:b})=>{const f=r.useCallback(async(n,h,A)=>{var m;if(b)return b(n,h,A);if(!l)throw new Error("No API service available");const H=`/plugins/jira-assets${h.startsWith("/")?h:`/${h}`}`;let U;switch(n.toUpperCase()){case"GET":U=await l.get(H);break;case"POST":U=await l.post(H,A);break;case"PUT":U=await l.put(H,A);break;case"PATCH":U=await l.patch(H,A);break;case"DELETE":U=await l.delete(H);break;default:throw new Error(`Unsupported method: ${n}`)}return((m=U.data)==null?void 0:m.data)??U.data},[l,b]),C=!!(l||b),[W,L]=r.useState([]),[d,v]=r.useState(!0),[S,z]=r.useState(!1),[o,E]=r.useState(null),[O,p]=r.useState(null),[J,j]=r.useState(!1),[_,N]=r.useState([]),[x,P]=r.useState(new Set),[G,q]=r.useState("non-organizational"),[B,a]=r.useState(!1),[g,w]=r.useState(!1),[F,Y]=r.useState(null),[c,$]=r.useState(null),[I,V]=r.useState(!1),D=r.useCallback(async()=>{if(C){v(!0),p(null);try{const n=await f("GET","/use-cases");Array.isArray(n)&&L(n)}catch(n){p(n.message||"Failed to load use cases")}finally{v(!1)}}},[C,f]),Z=r.useCallback(async()=>{if(C)try{const n=await f("GET","/sync/status");E(n)}catch(n){console.error("Failed to load sync status:",n)}},[C,f]);r.useEffect(()=>{D(),Z()},[D,Z]);const ee=async()=>{if(C){z(!0),p(null);try{const n=await f("POST","/sync");n!=null&&n.success?(await D(),await Z()):p((n==null?void 0:n.status)||"Sync failed")}catch(n){p(n.message||"Sync failed")}finally{z(!1)}}},se=async()=>{if(C){j(!0),a(!0),P(new Set),N([]);try{const n=await f("GET","/org-project");Y(n);const h=await f("GET","/config"),A=h==null?void 0:h.selected_object_type_id;if(!A){p("No object type configured. Please configure the plugin first."),a(!1);return}const H=await f("GET",`/object-types/${A}/objects`);if(Array.isArray(H)){const U=new Set(W.map(ne=>ne.jira_object_id)),m=H.filter(ne=>!U.has(ne.id));N(m)}}catch(n){p(n.message||"Failed to load JIRA objects")}finally{a(!1)}}},oe=n=>{P(h=>{const A=new Set(h);return A.has(n)?A.delete(n):A.add(n),A})},t=()=>{x.size===_.length?P(new Set):P(new Set(_.map(n=>n.id)))},i=async()=>{if(!(!f||x.size===0)){w(!0),p(null);try{const n=await f("POST","/import",{object_ids:Array.from(x),is_organizational:G==="organizational"});n!=null&&n.success?(j(!1),await D()):p((n==null?void 0:n.error)||"Import failed")}catch(n){p(n.message||"Import failed")}finally{w(!1)}}},k=n=>{$(n),V(!0)},y=async n=>{if(C)try{await f("PATCH",`/use-cases/${n.id}`,{is_organizational:!n.is_organizational}),await D()}catch(h){p(h.message||"Failed to update use case")}},u=async n=>{if(C&&window.confirm(`Are you sure you want to delete "${n.name}"?`))try{await f("DELETE",`/use-cases/${n.id}`),await D(),(c==null?void 0:c.id)===n.id&&(V(!1),$(null))}catch(h){p(h.message||"Failed to delete use case")}},M=n=>n?new Date(n).toLocaleString():"N/A",ae=n=>{switch(n){case"synced":return e.jsx(s.Chip,{label:"Synced",size:"small",color:"success",sx:{fontSize:"11px"}});case"updated":return e.jsx(s.Chip,{label:"Updated",size:"small",color:"info",sx:{fontSize:"11px"}});case"deleted_in_jira":return e.jsx(s.Chip,{label:"Deleted in JIRA",size:"small",color:"error",sx:{fontSize:"11px"}});default:return e.jsx(s.Chip,{label:n,size:"small",sx:{fontSize:"11px"}})}};return e.jsxs(s.Box,{sx:{p:3},children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"h6",fontWeight:600,children:"JIRA AI Systems"}),e.jsx(s.Typography,{variant:"body2",color:"text.secondary",fontSize:13,children:"AI Systems imported from Jira Service Management Assets"})]}),e.jsxs(s.Box,{sx:{display:"flex",gap:2},children:[e.jsx(s.Button,{variant:"outlined",startIcon:S?e.jsx(s.CircularProgress,{size:16}):e.jsx(ge,{size:16}),onClick:ee,disabled:S,sx:{borderColor:"#d0d5dd",color:"#344054",textTransform:"none",fontSize:"13px"},children:S?"Syncing...":"Sync Now"}),e.jsx(s.Button,{variant:"contained",startIcon:e.jsx(ye,{size:16}),onClick:se,sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px","&:hover":{backgroundColor:"#0f5a47"}},children:"Import from JIRA"})]})]}),o&&e.jsx(s.Alert,{severity:o.last_sync_status==="success"?"success":o.last_sync_status==="failed"?"warning":"info",sx:{mb:2,fontSize:"13px"},icon:e.jsx(pe,{size:18}),children:e.jsxs(s.Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs("span",{children:["Last sync: ",o.last_sync_at?M(o.last_sync_at):"Never"]}),o.sync_enabled&&e.jsx(s.Chip,{label:`Auto-sync: Every ${o.sync_interval_hours}h`,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"11px"}})]})}),O&&e.jsx(s.Alert,{severity:"error",sx:{mb:2,fontSize:"13px"},onClose:()=>p(null),children:O}),d?e.jsx(s.Box,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(s.CircularProgress,{})}):W.length===0?e.jsxs(s.Paper,{sx:{p:4,textAlign:"center"},children:[e.jsx(de,{size:48,color:"#98a2b3"}),e.jsx(s.Typography,{variant:"h6",sx:{mt:2,color:"#344054"},children:"No JIRA AI Systems Imported"}),e.jsx(s.Typography,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'Click "Import from JIRA" to start importing AI Systems from your JSM Assets.'})]}):e.jsx(s.TableContainer,{component:s.Paper,sx:{boxShadow:"none",border:"1px solid #e4e7ec"},children:e.jsxs(s.Table,{size:"small",children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{sx:{backgroundColor:"#f9fafb"},children:[e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"UC-ID"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Name"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"JIRA Key"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Type"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Sync Status"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Last Synced"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},align:"right",children:"Actions"})]})}),e.jsx(s.TableBody,{children:W.map(n=>e.jsxs(s.TableRow,{hover:!0,children:[e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:n.uc_id}),e.jsx(s.TableCell,{sx:{fontSize:"13px"},children:n.name}),e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:n.jira_object_key}),e.jsx(s.TableCell,{children:e.jsx(s.Chip,{icon:n.is_organizational?e.jsx(X,{size:14}):e.jsx(Q,{size:14}),label:n.is_organizational?"Organizational":"Non-Org",size:"small",color:n.is_organizational?"primary":"default",variant:"outlined",sx:{fontSize:"11px"}})}),e.jsx(s.TableCell,{children:ae(n.sync_status)}),e.jsx(s.TableCell,{sx:{fontSize:"12px",color:"#667085"},children:M(n.last_synced_at)}),e.jsxs(s.TableCell,{align:"right",children:[e.jsx(s.Tooltip,{title:"View Details",children:e.jsx(s.IconButton,{size:"small",onClick:()=>k(n),children:e.jsx(fe,{size:16})})}),e.jsx(s.Tooltip,{title:n.is_organizational?"Make Non-Organizational":"Make Organizational",children:e.jsx(s.IconButton,{size:"small",onClick:()=>y(n),children:n.is_organizational?e.jsx(Q,{size:16}):e.jsx(X,{size:16})})}),e.jsx(s.Tooltip,{title:"Delete",children:e.jsx(s.IconButton,{size:"small",onClick:()=>u(n),color:"error",children:e.jsx(te,{size:16})})})]})]},n.id))})]})}),e.jsxs(s.Dialog,{open:J,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(s.DialogTitle,{children:e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s.Typography,{variant:"h6",children:"Import AI Systems from JIRA"}),e.jsx(s.IconButton,{onClick:()=>j(!1),children:e.jsx(R,{size:20})})]})}),e.jsx(s.DialogContent,{dividers:!0,children:B?e.jsxs(s.Box,{sx:{py:4,textAlign:"center"},children:[e.jsx(s.CircularProgress,{}),e.jsx(s.Typography,{sx:{mt:2},children:"Loading objects from JIRA..."})]}):_.length===0?e.jsx(s.Alert,{severity:"info",children:"No new objects to import. All JIRA objects have already been imported."}):e.jsxs(e.Fragment,{children:[e.jsxs(s.Box,{sx:{mb:3},children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"Import Type"}),e.jsxs(s.RadioGroup,{value:G,onChange:n=>q(n.target.value),children:[e.jsx(s.FormControlLabel,{value:"non-organizational",control:e.jsx(s.Radio,{size:"small"}),label:e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,children:"Non-Organizational"}),e.jsx(s.Typography,{variant:"caption",color:"text.secondary",children:"Standalone use-cases with their own UC-IDs"})]})}),e.jsx(s.FormControlLabel,{value:"organizational",control:e.jsx(s.Radio,{size:"small"}),disabled:!F,label:e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,children:"Organizational"}),e.jsx(s.Typography,{variant:"caption",color:"text.secondary",children:F?`Links to organizational project: ${F.title}`:"No organizational project exists - create one first"})]})})]})]}),e.jsx(s.Divider,{sx:{my:2}}),e.jsxs(s.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s.FormControlLabel,{control:e.jsx(s.Checkbox,{checked:x.size===_.length&&_.length>0,indeterminate:x.size>0&&x.size<_.length,onChange:t,size:"small"}),label:e.jsxs(s.Typography,{variant:"body2",fontSize:13,children:["Select All (",_.length," objects)"]})}),e.jsxs(s.Typography,{variant:"body2",color:"text.secondary",children:[x.size," selected"]})]}),e.jsx(s.TableContainer,{sx:{maxHeight:400},children:e.jsxs(s.Table,{size:"small",stickyHeader:!0,children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{children:[e.jsx(s.TableCell,{padding:"checkbox"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Key"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Name"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Updated"})]})}),e.jsx(s.TableBody,{children:_.map(n=>e.jsxs(s.TableRow,{hover:!0,selected:x.has(n.id),onClick:()=>oe(n.id),sx:{cursor:"pointer"},children:[e.jsx(s.TableCell,{padding:"checkbox",children:e.jsx(s.Checkbox,{checked:x.has(n.id),size:"small"})}),e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:n.key}),e.jsx(s.TableCell,{sx:{fontSize:"13px"},children:n.name}),e.jsx(s.TableCell,{sx:{fontSize:"12px",color:"#667085"},children:M(n.updated)})]},n.id))})]})})]})}),e.jsxs(s.DialogActions,{sx:{p:2},children:[e.jsx(s.Button,{onClick:()=>j(!1),sx:{textTransform:"none"},children:"Cancel"}),e.jsx(s.Button,{variant:"contained",onClick:i,disabled:g||x.size===0,startIcon:g?e.jsx(s.CircularProgress,{size:16}):e.jsx(he,{size:16}),sx:{backgroundColor:"#13715B",textTransform:"none","&:hover":{backgroundColor:"#0f5a47"}},children:g?"Importing...":`Import ${x.size} Objects`})]})]}),e.jsx(s.Drawer,{anchor:"right",open:I,onClose:()=>V(!1),children:e.jsx(s.Box,{sx:{width:480,p:3},children:c&&e.jsxs(e.Fragment,{children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"h6",children:c.name}),e.jsxs(s.Typography,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:[c.uc_id," | ",c.jira_object_key]})]}),e.jsx(s.IconButton,{onClick:()=>V(!1),children:e.jsx(R,{size:20})})]}),e.jsxs(s.Stack,{spacing:2,children:[e.jsxs(s.Box,{sx:{display:"flex",gap:1},children:[e.jsx(s.Chip,{icon:c.is_organizational?e.jsx(X,{size:14}):e.jsx(Q,{size:14}),label:c.is_organizational?"Organizational":"Non-Organizational",size:"small",color:c.is_organizational?"primary":"default"}),ae(c.sync_status)]}),e.jsx(s.Divider,{}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"Sync Information"}),e.jsxs(s.Stack,{spacing:1,children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",children:"Last Synced"}),e.jsx(s.Typography,{variant:"body2",children:M(c.last_synced_at)})]}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",children:"JIRA Created"}),e.jsx(s.Typography,{variant:"body2",children:M(c.jira_created_at)})]}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",children:"JIRA Updated"}),e.jsx(s.Typography,{variant:"body2",children:M(c.jira_updated_at)})]})]})]}),e.jsx(s.Divider,{}),c.mapped_attributes&&Object.keys(c.mapped_attributes).length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1,color:"#13715B"},children:"VerifyWise AI System Attributes"}),e.jsx(s.Stack,{spacing:1,children:Object.entries(c.mapped_attributes).map(([n,h])=>e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:n}),e.jsx(s.Typography,{variant:"body2",sx:{wordBreak:"break-word"},children:Array.isArray(h)?h.join(", "):String(h??"N/A")})]},n))})]}),e.jsx(s.Divider,{})]}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"JIRA Attributes (Raw)"}),e.jsx(s.Stack,{spacing:1,children:Object.entries(c.attributes||{}).map(([n,h])=>e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:n}),e.jsx(s.Typography,{variant:"body2",sx:{wordBreak:"break-word"},children:Array.isArray(h)?h.join(", "):String(h??"N/A")})]},n))})]}),e.jsx(s.Divider,{}),e.jsxs(s.Box,{sx:{display:"flex",gap:2},children:[e.jsx(s.Button,{variant:"outlined",fullWidth:!0,onClick:()=>y(c),startIcon:c.is_organizational?e.jsx(Q,{size:16}):e.jsx(X,{size:16}),sx:{textTransform:"none"},children:c.is_organizational?"Make Non-Org":"Make Organizational"}),e.jsx(s.Button,{variant:"outlined",color:"error",fullWidth:!0,onClick:()=>u(c),startIcon:e.jsx(te,{size:16}),sx:{textTransform:"none"},children:"Delete"})]})]})]})})})]})};return K.JiraAssetsAttributeMapping=re,K.JiraAssetsConfiguration=xe,K.JiraAssetsUseCasesTab=Se,Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}),K}({},jsxRuntime,React,MUI);
//# sourceMappingURL=index.esm.js.map
